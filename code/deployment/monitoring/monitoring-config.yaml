# =============================================================================
# MONITORING & ALERTING CONFIGURATION
# =============================================================================

# Application Performance Monitoring
APM_CONFIG:
  # Sentry Configuration
  SENTRY_DSN: "${SENTRY_DSN}"
  SENTRY_ENVIRONMENT: "${NODE_ENV}"
  SENTRY_RELEASE: "${GIT_COMMIT_SHA}"
  SENTRY_SAMPLE_RATE: 0.1  # Sample 10% of transactions
  SENTRY_TRACES_SAMPLE_RATE: 0.05
  
  # Error Tracking
  ERROR_TRACKING:
    enabled: true
    sample_rate: 0.1
    ignored_errors:
      - "NetworkError"
      - "TypeError: Failed to fetch"
      - "ChunkLoadError"
    
  # Performance Tracking
  PERFORMANCE:
    enabled: true
    traces_sample_rate: 0.05
    long_task_threshold: 50  # milliseconds

# Database Monitoring
DATABASE_MONITORING:
  # Connection Pool Monitoring
  CONNECTION_POOL:
    max_connections: 100
    min_connections: 10
    timeout: 30000
    alert_thresholds:
      active_connections: 80
      waiting_connections: 5
      
  # Query Performance
  QUERY_MONITORING:
    slow_query_threshold: 1000  # milliseconds
    very_slow_query_threshold: 5000  # milliseconds
    alert_on_slow_queries: true
    
  # Database Health Checks
  HEALTH_CHECKS:
    enabled: true
    interval: 60  # seconds
    timeout: 10  # seconds
    retry_attempts: 3

# API Monitoring
API_MONITORING:
  # Response Time Monitoring
  RESPONSE_TIME:
    warning_threshold: 1000  # milliseconds
    critical_threshold: 3000  # milliseconds
    alert_on_p95: true
    alert_on_p99: true
    
  # Error Rate Monitoring
  ERROR_RATE:
    warning_threshold: 0.02  # 2%
    critical_threshold: 0.05  # 5%
    time_window: 300  # seconds
    
  # Rate Limiting
  RATE_LIMITING:
    enabled: true
    requests_per_minute: 1000
    burst_limit: 100
    
  # Endpoint Monitoring
  ENDPOINTS:
    - name: "health_check"
      url: "/api/health"
      expected_status: 200
      timeout: 5000
      
    - name: "user_profile"
      url: "/api/user/profile"
      expected_status: 200
      timeout: 10000
      
    - name: "analytics_summary"
      url: "/api/analytics/summary"
      expected_status: 200
      timeout: 15000

# A/B Testing Monitoring
AB_TESTING_MONITORING:
  # Conversion Rate Monitoring
  CONVERSION_RATE:
    baseline_rate: 0.05  # 5%
    minimum_detectable_effect: 0.02  # 2%
    confidence_level: 0.95
    statistical_power: 0.8
    
  # Traffic Distribution
  TRAFFIC_DISTRIBUTION:
    enabled: true
    tolerance: 0.05  # 5% tolerance from expected split
    check_interval: 3600  # seconds
    
  # Test Performance
  TEST_PERFORMANCE:
    minimum_sample_size: 100
    minimum_duration: 7  # days
    maximum_duration: 30  # days
    
  # Alert Thresholds
  ALERTS:
    conversion_rate_drop: 0.20  # 20% drop
    traffic_imbalance: 0.10  # 10% imbalance
    sample_size_insufficient: true

# Conversion Tracking Monitoring
CONVERSION_MONITORING:
  # Event Tracking
  EVENT_TRACKING:
    enabled: true
    batch_size: 100
    flush_interval: 5000  # milliseconds
    retry_attempts: 3
    
  # Funnel Analysis
  FUNNEL_ANALYSIS:
    steps:
      - "impression"
      - "click"
      - "consideration"
      - "trial_signup"
      - "conversion"
      
  # Conversion Rates
  CONVERSION_RATES:
    impression_to_click: 0.15
    click_to_consideration: 0.60
    consideration_to_trial: 0.25
    trial_to_conversion: 0.30
    
  # Alert Thresholds
  ALERTS:
    funnel_drop_rate: 0.50  # 50% drop at any step
    overall_conversion_rate: 0.03  # 3% minimum

# Infrastructure Monitoring
INFRASTRUCTURE_MONITORING:
  # Server Resources
  SERVER:
    cpu_threshold: 80  # percentage
    memory_threshold: 85  # percentage
    disk_threshold: 90  # percentage
    
  # Edge Functions
  EDGE_FUNCTIONS:
    cold_start_threshold: 1000  # milliseconds
    execution_timeout: 30000  # milliseconds
    memory_limit: 512  # MB
    
  # CDN Performance
  CDN:
    cache_hit_ratio: 0.85  # 85% minimum
    response_time_threshold: 200  # milliseconds

# Business Metrics Monitoring
BUSINESS_METRICS:
  # User Engagement
  USER_ENGAGEMENT:
    session_duration_warning: 120  # seconds
    session_duration_critical: 60  # seconds
    bounce_rate_warning: 0.60  # 60%
    bounce_rate_critical: 0.80  # 80%
    
  # User Registration
  USER_REGISTRATION:
    daily_target: 100
    warning_threshold: 0.70  # 70% of target
    critical_threshold: 0.50  # 50% of target
    
  # Subscription Metrics
  SUBSCRIPTIONS:
    trial_conversion_target: 0.25  # 25%
    churn_rate_warning: 0.10  # 10% monthly
    churn_rate_critical: 0.15  # 15% monthly

# Alert Configuration
ALERT_CONFIG:
  # Notification Channels
  CHANNELS:
    EMAIL:
      enabled: true
      recipients:
        - "dev-team@company.com"
        - "product@company.com"
        - "support@company.com"
        
    SLACK:
      enabled: true
      webhook_url: "${SLACK_WEBHOOK_URL}"
      channel: "#alerts"
      username: "Monitoring Bot"
      
    PAGERDUTY:
      enabled: true
      service_key: "${PAGERDUTY_SERVICE_KEY}"
      
  # Alert Rules
  RULES:
    # Critical Alerts
    - name: "high_error_rate"
      condition: "error_rate > 0.05"
      severity: "critical"
      channels: ["email", "slack", "pagerduty"]
      cooldown: 300  # seconds
      
    - name: "database_connection_failure"
      condition: "db_connection_failed == true"
      severity: "critical"
      channels: ["email", "slack", "pagerduty"]
      cooldown: 60  # seconds
      
    - name: "api_response_time_high"
      condition: "avg_response_time > 3000"
      severity: "critical"
      channels: ["email", "slack"]
      cooldown: 600  # seconds
      
    # Warning Alerts
    - name: "conversion_rate_drop"
      condition: "conversion_rate < baseline_rate * 0.8"
      severity: "warning"
      channels: ["email", "slack"]
      cooldown: 3600  # seconds
      
    - name: "ab_test_traffic_imbalance"
      condition: "traffic_imbalance > 0.1"
      severity: "warning"
      channels: ["email"]
      cooldown: 1800  # seconds
      
    - name: "user_registration_drop"
      condition: "daily_registrations < target * 0.7"
      severity: "warning"
      channels: ["email"]
      cooldown: 7200  # seconds
      
    # Info Alerts
    - name: "ab_test_significance_reached"
      condition: "ab_test_significance == true"
      severity: "info"
      channels: ["email"]
      cooldown: 86400  # seconds

# Dashboard Configuration
DASHBOARD_CONFIG:
  # Real-time Dashboards
  REALTIME:
    enabled: true
    refresh_interval: 30  # seconds
    metrics:
      - "active_users"
      - "response_time"
      - "error_rate"
      - "conversion_rate"
      
  # Performance Dashboards
  PERFORMANCE:
    enabled: true
    refresh_interval: 300  # seconds
    metrics:
      - "api_response_time"
      - "database_query_time"
      - "cdn_cache_hit_ratio"
      - "edge_function_execution_time"
      
  # Business Dashboards
  BUSINESS:
    enabled: true
    refresh_interval: 3600  # seconds
    metrics:
      - "user_registrations"
      - "trial_signups"
      - "subscription_conversions"
      - "revenue"

# Log Configuration
LOG_CONFIG:
  # Log Levels
  LEVELS:
    development: "debug"
    staging: "info"
    production: "warn"
    
  # Log Retention
  RETENTION:
    application_logs: 30  # days
    access_logs: 7  # days
    error_logs: 90  # days
    
  # Log Aggregation
  AGGREGATION:
    enabled: true
    service: "datadog"  # or "cloudwatch", "elk"
    api_key: "${LOG_AGGREGATION_API_KEY}"

# Security Monitoring
SECURITY_MONITORING:
  # Authentication Monitoring
  AUTHENTICATION:
    failed_login_threshold: 10  # per hour
    suspicious_activity_detection: true
    
  # API Security
  API_SECURITY:
    rate_limit_violations: true
    invalid_tokens: true
    sql_injection_attempts: true
    
  # Data Protection
  DATA_PROTECTION:
    pii_access_logging: true
    data_export_monitoring: true
    unauthorized_access: true

# Compliance Monitoring
COMPLIANCE_MONITORING:
  # GDPR Compliance
  GDPR:
    data_retention_policy: true
    user_consent_tracking: true
    data_deletion_requests: true
    
  # Security Auditing
  AUDITING:
    enabled: true
    log_all_actions: false
    critical_actions_only: true
    
# Backup Monitoring
BACKUP_MONITORING:
  # Database Backups
  DATABASE_BACKUPS:
    enabled: true
    frequency: "daily"
    retention: 90  # days
    verify_backups: true
    
  # File Backups
  FILE_BACKUPS:
    enabled: true
    frequency: "weekly"
    retention: 30  # days
    
  # Backup Alerts
  BACKUP_ALERTS:
    failed_backup: true
    backup_age_exceeded: true
    storage_space_low: true